import tkinter as tk
from tkinter import ttk
from matplotlib.backends.backend_tkagg import FigureCanvasTkAgg
import matplotlib.pyplot as plt
from plots import RealTimeScatter 


class AnalysisTab(ttk.Frame):
    def __init__(self, parent, fonts):
        super().__init__(parent)
        self.fonts = fonts
        self._create_widgets()

    def _create_widgets(self):

        # Main container
        container = ttk.Frame(self)
        container.pack(fill="both", expand=True, padx=10, pady=10)

        # Frames
        left_frame = ttk.Frame(container)
        left_frame.pack(side="left", fill="both", expand=True, padx=(0, 5))
        right_frame = ttk.Frame(container)
        right_frame.pack(side="left", fill="both", expand=True, padx=(5, 0))

        #Fore-Vel
        self.fv_plot = RealTimeScatter(
            master=left_frame,
            x_label="Velocity [mm/s]",
            y_label="Force [N]",
            x_range=(-200, 200),      
            y_range=(-1000, 1000),
            figsize=(5, 4)
        )

        # Force-Disp
        self.fd_plot = RealTimeScatter(
            master=right_frame,
            x_label="Displacement [mm]",
            y_label="Force [N]",
            x_range=(0, 40),
            y_range=(-1000, 1000),
            figsize=(5, 4)
        )

        btn_frame = ttk.Frame(self)
        btn_frame.pack(pady=8)

        self.reset_button = ttk.Button(
            btn_frame,
            text="Reset Analysis Plots",
            style="Big.TButton",
            command=self.reset_plots
        )
        self.reset_button.pack()

    def update_analysis(self, run_tab):
        """
        Append new samples to both RealTimeScatter plots.
        Called from RunTestTab after new sensor samples arrive.
        """

        # Get latest samples from run_tab
        vel_samples = run_tab.new_velocity_samples
        disp_samples = run_tab.new_displacement_samples
        force_samples = run_tab.new_force_samples

        # Velocity-based plot
        self.fv_plot.update(vel_samples, force_samples)

        # Displacement-based plot
        self.fd_plot.update(disp_samples, force_samples)

    def reset_plots(self):
        self.fv_plot.reset()
        self.fd_plot.reset()
